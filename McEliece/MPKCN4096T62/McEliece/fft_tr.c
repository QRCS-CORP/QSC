#include "fft_tr.h"
#include "transpose.h"
#include "vec.h"

static void radix_conversions_tr(uint64_t in[][MCELIECE_GFBITS]) 
{
	int32_t i;
	int32_t j;
	int32_t k;

	const uint64_t mask[6][2] = 
	{
		{ 0x2222222222222222ULL, 0x4444444444444444ULL },
		{ 0x0C0C0C0C0C0C0C0CULL, 0x3030303030303030ULL },
		{ 0x00F000F000F000F0ULL, 0x0F000F000F000F00ULL },
		{ 0x0000FF000000FF00ULL, 0x00FF000000FF0000ULL },
		{ 0x00000000FFFF0000ULL, 0x0000FFFF00000000ULL },
		{ 0xFFFFFFFF00000000ULL, 0x00000000FFFFFFFFULL }
	};

	const uint64_t s[5][2][MCELIECE_GFBITS] =
	{
		{ 
			{
				0xF3CFC030FC30F003ULL,
				0x3FCF0F003C00C00CULL,
				0x30033CC300C0C03CULL,
				0xCCFF0F3C0F30F0C0ULL,
				0x0300C03FF303C3F0ULL,
				0x3FFF3C0FF0CCCCC0ULL,
				0xF3FFF0C00F3C3CC0ULL,
				0x3003333FFFC3C000ULL,
				0x0FF30FFFC3FFF300ULL,
				0xFFC0F300F0F0CC00ULL,
				0xC0CFF3FCCC3CFC00ULL,
				0xFC3C03F0F330C000ULL,
			},
			{
				0x000C03C0C3C0330CULL,
				0xF330CFFCC00F33C0ULL,
				0xCCF330F00F3C0333ULL,
				0xFF03FFF3FF0CF0C0ULL,
				0x3CC3FCF00FCC303CULL,
				0x0F000C0FC30303F3ULL,
				0xCF0FC3FF333CCF3CULL,
				0x003F3FC3C0FF333FULL,
				0x3CC3F0F3CF0FF00FULL,
				0xF3F33CC03FC30CC0ULL,
				0x3CC330CFC333F33FULL,
				0x3CC0303FF3C3FFFCULL,
			} 
		},
		{ 
			{
				0x000F00000000F00FULL,
				0x00000F00F00000F0ULL,
				0x0F00000F00000F00ULL,
				0xF00F00F00F000000ULL,
				0x00F00000000000F0ULL,
				0x0000000F00000000ULL,
				0xF00000000F00F000ULL,
				0x00F00F00000F0000ULL,
				0x0000F00000F00F00ULL,
				0x000F00F00F00F000ULL,
				0x00F00F0000000000ULL,
				0x0000000000F00000ULL,
			},
			{
				0x0F00F00F00000000ULL,
				0xF00000000000F000ULL,
				0x00000F00000000F0ULL,
				0x0F00F00000F00000ULL,
				0x000F00000F00F00FULL,
				0x00F00F00F00F0000ULL,
				0x0F00F00000000000ULL,
				0x000000000F000000ULL,
				0x00F00000000F00F0ULL,
				0x0000F00F00000F00ULL,
				0xF00000F00000F00FULL,
				0x00000F00F00F00F0ULL,
			} 
		},
		{ 
			{
				0x0000FF00FF0000FFULL,
				0x0000FF000000FF00ULL,
				0xFF0000FF00FF0000ULL,
				0xFFFF0000FF000000ULL,
				0x00FF00FF00FF0000ULL,
				0x0000FFFFFF000000ULL,
				0x00FFFF00FF000000ULL,
				0xFFFFFF0000FF0000ULL,
				0xFFFF00FFFF00FF00ULL,
				0x0000FF0000000000ULL,
				0xFFFFFF00FF000000ULL,
				0x00FF000000000000ULL,
			},
			{
				0xFF00FFFFFF000000ULL,
				0xFF0000FFFF000000ULL,
				0xFFFF00FFFF000000ULL,
				0xFF00FFFFFFFFFF00ULL,
				0x00000000FF00FF00ULL,
				0xFFFFFFFF00FF0000ULL,
				0x00FFFFFF00FF0000ULL,
				0xFFFF00FFFF00FFFFULL,
				0xFFFF0000FFFFFFFFULL,
				0xFF00000000FF0000ULL,
				0x000000FF00FF00FFULL,
				0x00FF00FF00FFFF00ULL,
			}
		},
		{
			{
				0x000000000000FFFFULL,
				0x00000000FFFF0000ULL,
				0x0000000000000000ULL,
				0xFFFF000000000000ULL,
				0x00000000FFFF0000ULL,
				0x0000FFFF00000000ULL,
				0x0000000000000000ULL,
				0x00000000FFFF0000ULL,
				0x0000FFFF00000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
			},
			{
				0x0000000000000000ULL,
				0xFFFF000000000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
				0xFFFF00000000FFFFULL,
				0x0000000000000000ULL,
				0x0000FFFF00000000ULL,
				0xFFFF00000000FFFFULL,
				0x00000000FFFF0000ULL,
				0x0000000000000000ULL,
				0xFFFF00000000FFFFULL,
				0x00000000FFFF0000ULL,
			} 
		},
		{ 
			{
				0x00000000FFFFFFFFULL,
				0xFFFFFFFF00000000ULL,
				0xFFFFFFFF00000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
				0xFFFFFFFF00000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
				0xFFFFFFFF00000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
				0x0000000000000000ULL,
			},
			{
				0x0000000000000000ULL,
				0x0000000000000000ULL,
				0x00000000FFFFFFFFULL,
				0xFFFFFFFF00000000ULL,
				0xFFFFFFFF00000000ULL,
				0x0000000000000000ULL,
				0xFFFFFFFF00000000ULL,
				0xFFFFFFFFFFFFFFFFULL,
				0xFFFFFFFF00000000ULL,
				0x0000000000000000ULL,
				0xFFFFFFFFFFFFFFFFULL,
				0xFFFFFFFF00000000ULL,
			} 
		}
	};

	for (j = 5; j >= 0; j--) 
	{
		if (j < 5) 
		{
			vec_mul(in[0], in[0], s[j][0]);
			vec_mul(in[1], in[1], s[j][1]);
		}

		for (i = 0; i < MCELIECE_GFBITS; i++)
		{
			for (k = j; k <= 4; k++)
			{
				in[0][i] ^= (in[0][i] & mask[k][0]) << (1 << k);
				in[0][i] ^= (in[0][i] & mask[k][1]) << (1 << k);
				in[1][i] ^= (in[1][i] & mask[k][0]) << (1 << k);
				in[1][i] ^= (in[1][i] & mask[k][1]) << (1 << k);
			}
		}

		for (i = 0; i < MCELIECE_GFBITS; i++)
		{
			in[1][i] ^= (in[0][i] & mask[5][0]) >> 32;
			in[1][i] ^= (in[1][i] & mask[5][1]) << 32;
		}
	}
}

static void butterflies_tr(uint64_t out[][MCELIECE_GFBITS], uint64_t in[][MCELIECE_GFBITS]) 
{
	uint64_t buf[64];
	uint64_t pre[6][MCELIECE_GFBITS];
	uint64_t tmp[MCELIECE_GFBITS];
	uint64_t ctr;
	int32_t i;
	int32_t j;
	int32_t k;
	int32_t s;

	const uint64_t consts[63][MCELIECE_GFBITS] =
	{
		{
			0xF00F0FF0F00F0FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0x0FF00FF00FF00FF0ULL, 0xAA5555AAAA5555AAULL,
			0xF00F0FF0F00F0FF0ULL, 0x33CCCC33CC3333CCULL, 0xFFFF0000FFFF0000ULL, 0xCC33CC3333CC33CCULL,
			0x33CC33CC33CC33CCULL, 0x5A5A5A5A5A5A5A5AULL, 0xFF00FF00FF00FF00ULL, 0xF00F0FF0F00F0FF0ULL,
		},
		{
			0x3C3C3C3C3C3C3C3CULL, 0xF0F0F0F0F0F0F0F0ULL, 0x5555AAAA5555AAAAULL, 0xCC3333CCCC3333CCULL,
			0xC33CC33CC33CC33CULL, 0x55555555AAAAAAAAULL, 0x33333333CCCCCCCCULL, 0x00FF00FFFF00FF00ULL,
			0xF0F0F0F0F0F0F0F0ULL, 0x0000000000000000ULL, 0x0000FFFFFFFF0000ULL, 0xF0F00F0F0F0FF0F0ULL,
		},
		{
			0x3C3C3C3C3C3C3C3CULL, 0x0F0F0F0F0F0F0F0FULL, 0xAAAA5555AAAA5555ULL, 0xCC3333CCCC3333CCULL,
			0xC33CC33CC33CC33CULL, 0x55555555AAAAAAAAULL, 0x33333333CCCCCCCCULL, 0xFF00FF0000FF00FFULL,
			0x0F0F0F0F0F0F0F0FULL, 0x0000000000000000ULL, 0x0000FFFFFFFF0000ULL, 0xF0F00F0F0F0FF0F0ULL,
		},
		{
			0xAA55AA5555AA55AAULL, 0xCC33CC3333CC33CCULL, 0x33CCCC33CC3333CCULL, 0x55555555AAAAAAAAULL,
			0xFF0000FF00FFFF00ULL, 0x3CC33CC3C33CC33CULL, 0x5555AAAA5555AAAAULL, 0x0FF00FF00FF00FF0ULL,
			0xCCCC33333333CCCCULL, 0xF0F0F0F0F0F0F0F0ULL, 0x00FFFF0000FFFF00ULL, 0xC33CC33CC33CC33CULL,
		},
		{
			0x55AA55AAAA55AA55ULL, 0xCC33CC3333CC33CCULL, 0xCC3333CC33CCCC33ULL, 0x55555555AAAAAAAAULL,
			0xFF0000FF00FFFF00ULL, 0xC33CC33C3CC33CC3ULL, 0xAAAA5555AAAA5555ULL, 0xF00FF00FF00FF00FULL,
			0x3333CCCCCCCC3333ULL, 0x0F0F0F0F0F0F0F0FULL, 0xFF0000FFFF0000FFULL, 0xC33CC33CC33CC33CULL,
		},
		{
			0xAA55AA5555AA55AAULL, 0x33CC33CCCC33CC33ULL, 0xCC3333CC33CCCC33ULL, 0x55555555AAAAAAAAULL,
			0x00FFFF00FF0000FFULL, 0x3CC33CC3C33CC33CULL, 0x5555AAAA5555AAAAULL, 0x0FF00FF00FF00FF0ULL,
			0x3333CCCCCCCC3333ULL, 0xF0F0F0F0F0F0F0F0ULL, 0x00FFFF0000FFFF00ULL, 0xC33CC33CC33CC33CULL,
		},
		{
			0x55AA55AAAA55AA55ULL, 0x33CC33CCCC33CC33ULL, 0x33CCCC33CC3333CCULL, 0x55555555AAAAAAAAULL,
			0x00FFFF00FF0000FFULL, 0xC33CC33C3CC33CC3ULL, 0xAAAA5555AAAA5555ULL, 0xF00FF00FF00FF00FULL,
			0xCCCC33333333CCCCULL, 0x0F0F0F0F0F0F0F0FULL, 0xFF0000FFFF0000FFULL, 0xC33CC33CC33CC33CULL,
		},
		{
			0x6699669999669966ULL, 0x33CCCC33CC3333CCULL, 0xA5A5A5A55A5A5A5AULL, 0x3C3CC3C3C3C33C3CULL,
			0xF00FF00F0FF00FF0ULL, 0x55AA55AA55AA55AAULL, 0x3C3CC3C3C3C33C3CULL, 0x0F0F0F0FF0F0F0F0ULL,
			0x55AA55AA55AA55AAULL, 0x33CCCC33CC3333CCULL, 0xF0F0F0F0F0F0F0F0ULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x9966996666996699ULL, 0x33CCCC33CC3333CCULL, 0xA5A5A5A55A5A5A5AULL, 0x3C3CC3C3C3C33C3CULL,
			0x0FF00FF0F00FF00FULL, 0xAA55AA55AA55AA55ULL, 0x3C3CC3C3C3C33C3CULL, 0xF0F0F0F00F0F0F0FULL,
			0xAA55AA55AA55AA55ULL, 0xCC3333CC33CCCC33ULL, 0x0F0F0F0F0F0F0F0FULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x6699669999669966ULL, 0x33CCCC33CC3333CCULL, 0x5A5A5A5AA5A5A5A5ULL, 0xC3C33C3C3C3CC3C3ULL,
			0x0FF00FF0F00FF00FULL, 0xAA55AA55AA55AA55ULL, 0xC3C33C3C3C3CC3C3ULL, 0x0F0F0F0FF0F0F0F0ULL,
			0xAA55AA55AA55AA55ULL, 0x33CCCC33CC3333CCULL, 0xF0F0F0F0F0F0F0F0ULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x9966996666996699ULL, 0x33CCCC33CC3333CCULL, 0x5A5A5A5AA5A5A5A5ULL, 0xC3C33C3C3C3CC3C3ULL,
			0xF00FF00F0FF00FF0ULL, 0x55AA55AA55AA55AAULL, 0xC3C33C3C3C3CC3C3ULL, 0xF0F0F0F00F0F0F0FULL,
			0x55AA55AA55AA55AAULL, 0xCC3333CC33CCCC33ULL, 0x0F0F0F0F0F0F0F0FULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x6699669999669966ULL, 0xCC3333CC33CCCC33ULL, 0x5A5A5A5AA5A5A5A5ULL, 0x3C3CC3C3C3C33C3CULL,
			0x0FF00FF0F00FF00FULL, 0x55AA55AA55AA55AAULL, 0x3C3CC3C3C3C33C3CULL, 0x0F0F0F0FF0F0F0F0ULL,
			0x55AA55AA55AA55AAULL, 0x33CCCC33CC3333CCULL, 0xF0F0F0F0F0F0F0F0ULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x9966996666996699ULL, 0xCC3333CC33CCCC33ULL, 0x5A5A5A5AA5A5A5A5ULL, 0x3C3CC3C3C3C33C3CULL,
			0xF00FF00F0FF00FF0ULL, 0xAA55AA55AA55AA55ULL, 0x3C3CC3C3C3C33C3CULL, 0xF0F0F0F00F0F0F0FULL,
			0xAA55AA55AA55AA55ULL, 0xCC3333CC33CCCC33ULL, 0x0F0F0F0F0F0F0F0FULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x6699669999669966ULL, 0xCC3333CC33CCCC33ULL, 0xA5A5A5A55A5A5A5AULL, 0xC3C33C3C3C3CC3C3ULL,
			0xF00FF00F0FF00FF0ULL, 0xAA55AA55AA55AA55ULL, 0xC3C33C3C3C3CC3C3ULL, 0x0F0F0F0FF0F0F0F0ULL,
			0xAA55AA55AA55AA55ULL, 0x33CCCC33CC3333CCULL, 0xF0F0F0F0F0F0F0F0ULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x9966996666996699ULL, 0xCC3333CC33CCCC33ULL, 0xA5A5A5A55A5A5A5AULL, 0xC3C33C3C3C3CC3C3ULL,
			0x0FF00FF0F00FF00FULL, 0x55AA55AA55AA55AAULL, 0xC3C33C3C3C3CC3C3ULL, 0xF0F0F0F00F0F0F0FULL,
			0x55AA55AA55AA55AAULL, 0xCC3333CC33CCCC33ULL, 0x0F0F0F0F0F0F0F0FULL, 0xA55A5AA55AA5A55AULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x6996699669966996ULL, 0x00FFFF0000FFFF00ULL,
			0xFF00FF00FF00FF00ULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x6996699669966996ULL, 0x00FFFF0000FFFF00ULL,
			0x00FF00FF00FF00FFULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x6996699669966996ULL, 0xFF0000FFFF0000FFULL,
			0x00FF00FF00FF00FFULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x6996699669966996ULL, 0xFF0000FFFF0000FFULL,
			0xFF00FF00FF00FF00ULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x9669966996699669ULL, 0xFF0000FFFF0000FFULL,
			0x00FF00FF00FF00FFULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x9669966996699669ULL, 0xFF0000FFFF0000FFULL,
			0xFF00FF00FF00FF00ULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x9669966996699669ULL, 0x00FFFF0000FFFF00ULL,
			0xFF00FF00FF00FF00ULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x6996699669966996ULL, 0x9669966996699669ULL, 0x00FFFF0000FFFF00ULL,
			0x00FF00FF00FF00FFULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x9669966996699669ULL, 0x00FFFF0000FFFF00ULL,
			0xFF00FF00FF00FF00ULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x9669966996699669ULL, 0x00FFFF0000FFFF00ULL,
			0x00FF00FF00FF00FFULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x9669966996699669ULL, 0xFF0000FFFF0000FFULL,
			0x00FF00FF00FF00FFULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x9669966996699669ULL, 0xFF0000FFFF0000FFULL,
			0xFF00FF00FF00FF00ULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x6996699669966996ULL, 0xFF0000FFFF0000FFULL,
			0x00FF00FF00FF00FFULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x6996699669966996ULL, 0xFF0000FFFF0000FFULL,
			0xFF00FF00FF00FF00ULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x6996699669966996ULL, 0x00FFFF0000FFFF00ULL,
			0xFF00FF00FF00FF00ULL, 0x0FF00FF0F00FF00FULL, 0x0F0FF0F0F0F00F0FULL, 0xC33C3CC33CC3C33CULL,
			0xC33C3CC33CC3C33CULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x9669699696696996ULL, 0x9669966996699669ULL, 0x6996699669966996ULL, 0x00FFFF0000FFFF00ULL,
			0x00FF00FF00FF00FFULL, 0xF00FF00F0FF00FF0ULL, 0xF0F00F0F0F0FF0F0ULL, 0x3CC3C33CC33C3CC3ULL,
			0x3CC3C33CC33C3CC3ULL, 0xA55A5AA55AA5A55AULL, 0xC33C3CC33CC3C33CULL, 0x3CC3C33C3CC3C33CULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0x0000000000000000ULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		},
		{
			0x0000000000000000ULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL,
			0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFFFFFFFFFFULL, 0xFFFFFFFF00000000ULL, 0xFFFF0000FFFF0000ULL,
			0xFF00FF00FF00FF00ULL, 0xF0F0F0F0F0F0F0F0ULL, 0xCCCCCCCCCCCCCCCCULL, 0xAAAAAAAAAAAAAAAAULL,
		}
	};

	const uint8_t reversal[64] = 
	{
		0x00, 0x20, 0x10, 0x30, 0x08, 0x28, 0x18, 0x38,
		0x04, 0x24, 0x14, 0x34, 0x0C, 0x2C, 0x1C, 0x3C,
		0x02, 0x22, 0x12, 0x32, 0x0A, 0x2A, 0x1A, 0x3A,
		0x06, 0x26, 0x16, 0x36, 0x0E, 0x2E, 0x1E, 0x3E,
		0x01, 0x21, 0x11, 0x31, 0x09, 0x29, 0x19, 0x39,
		0x05, 0x25, 0x15, 0x35, 0x0D, 0x2D, 0x1D, 0x3D,
		0x03, 0x23, 0x13, 0x33, 0x0B, 0x2B, 0x1B, 0x3B,
		0x07, 0x27, 0x17, 0x37, 0x0F, 0x2F, 0x1F, 0x3F
	};

	const uint16_t beta[6] = 
	{
		8, 1300, 3408, 1354, 2341, 1154
	};

	ctr = 63;

	/* butterflies */
	for (i = 5; i >= 0; i--)
	{
		s = 1 << i;
		ctr -= s;

		for (j = 0; j < 64; j += 2 * s)
		{
			for (k = j; k < j + s; k++)
			{
				vec_add(in[k], in[k], in[k + s]);
				vec_mul(tmp, in[k], consts[ctr + (k - j)]);
				vec_add(in[k + s], in[k + s], tmp);
			}
		}
	}

	/* transpose */
	for (i = 0; i < MCELIECE_GFBITS; i++) 
	{
		for (j = 0; j < 64; j++)
		{
			buf[reversal[j]] = in[j][i];
		}

		transpose_64x64_compact(buf, buf);

		for (j = 0; j < 64; j++)
		{
			in[j][i] = buf[j];
		}
	}

	/* broadcast */
	vec_copy(pre[0], in[32]);
	vec_add(in[33], in[33], in[32]);
	vec_copy(pre[1], in[33]);
	vec_add(in[35], in[35], in[33]);
	vec_add(pre[0], pre[0], in[35]);
	vec_add(in[34], in[34], in[35]);
	vec_copy(pre[2], in[34]);
	vec_add(in[38], in[38], in[34]);
	vec_add(pre[0], pre[0], in[38]);
	vec_add(in[39], in[39], in[38]);
	vec_add(pre[1], pre[1], in[39]);
	vec_add(in[37], in[37], in[39]);
	vec_add(pre[0], pre[0], in[37]);
	vec_add(in[36], in[36], in[37]);
	vec_copy(pre[3], in[36]);
	vec_add(in[44], in[44], in[36]);
	vec_add(pre[0], pre[0], in[44]);
	vec_add(in[45], in[45], in[44]);
	vec_add(pre[1], pre[1], in[45]);
	vec_add(in[47], in[47], in[45]);
	vec_add(pre[0], pre[0], in[47]);
	vec_add(in[46], in[46], in[47]);
	vec_add(pre[2], pre[2], in[46]);
	vec_add(in[42], in[42], in[46]);
	vec_add(pre[0], pre[0], in[42]);
	vec_add(in[43], in[43], in[42]);
	vec_add(pre[1], pre[1], in[43]);
	vec_add(in[41], in[41], in[43]);
	vec_add(pre[0], pre[0], in[41]);
	vec_add(in[40], in[40], in[41]);
	vec_copy(pre[4], in[40]);
	vec_add(in[56], in[56], in[40]);
	vec_add(pre[0], pre[0], in[56]);
	vec_add(in[57], in[57], in[56]);
	vec_add(pre[1], pre[1], in[57]);
	vec_add(in[59], in[59], in[57]);
	vec_add(pre[0], pre[0], in[59]);
	vec_add(in[58], in[58], in[59]);
	vec_add(pre[2], pre[2], in[58]);
	vec_add(in[62], in[62], in[58]);
	vec_add(pre[0], pre[0], in[62]);
	vec_add(in[63], in[63], in[62]);
	vec_add(pre[1], pre[1], in[63]);
	vec_add(in[61], in[61], in[63]);
	vec_add(pre[0], pre[0], in[61]);
	vec_add(in[60], in[60], in[61]);
	vec_add(pre[3], pre[3], in[60]);
	vec_add(in[52], in[52], in[60]);
	vec_add(pre[0], pre[0], in[52]);
	vec_add(in[53], in[53], in[52]);
	vec_add(pre[1], pre[1], in[53]);
	vec_add(in[55], in[55], in[53]);
	vec_add(pre[0], pre[0], in[55]);
	vec_add(in[54], in[54], in[55]);
	vec_add(pre[2], pre[2], in[54]);
	vec_add(in[50], in[50], in[54]);
	vec_add(pre[0], pre[0], in[50]);
	vec_add(in[51], in[51], in[50]);
	vec_add(pre[1], pre[1], in[51]);
	vec_add(in[49], in[49], in[51]);
	vec_add(pre[0], pre[0], in[49]);
	vec_add(in[48], in[48], in[49]);
	vec_copy(pre[5], in[48]);
	vec_add(in[16], in[16], in[48]);
	vec_add(pre[0], pre[0], in[16]);
	vec_add(in[17], in[17], in[16]);
	vec_add(pre[1], pre[1], in[17]);
	vec_add(in[19], in[19], in[17]);
	vec_add(pre[0], pre[0], in[19]);
	vec_add(in[18], in[18], in[19]);
	vec_add(pre[2], pre[2], in[18]);
	vec_add(in[22], in[22], in[18]);
	vec_add(pre[0], pre[0], in[22]);
	vec_add(in[23], in[23], in[22]);
	vec_add(pre[1], pre[1], in[23]);
	vec_add(in[21], in[21], in[23]);
	vec_add(pre[0], pre[0], in[21]);
	vec_add(in[20], in[20], in[21]);
	vec_add(pre[3], pre[3], in[20]);
	vec_add(in[28], in[28], in[20]);
	vec_add(pre[0], pre[0], in[28]);
	vec_add(in[29], in[29], in[28]);
	vec_add(pre[1], pre[1], in[29]);
	vec_add(in[31], in[31], in[29]);
	vec_add(pre[0], pre[0], in[31]);
	vec_add(in[30], in[30], in[31]);
	vec_add(pre[2], pre[2], in[30]);
	vec_add(in[26], in[26], in[30]);
	vec_add(pre[0], pre[0], in[26]);
	vec_add(in[27], in[27], in[26]);
	vec_add(pre[1], pre[1], in[27]);
	vec_add(in[25], in[25], in[27]);
	vec_add(pre[0], pre[0], in[25]);
	vec_add(in[24], in[24], in[25]);
	vec_add(pre[4], pre[4], in[24]);
	vec_add(in[8], in[8], in[24]);
	vec_add(pre[0], pre[0], in[8]);
	vec_add(in[9], in[9], in[8]);
	vec_add(pre[1], pre[1], in[9]);
	vec_add(in[11], in[11], in[9]);
	vec_add(pre[0], pre[0], in[11]);
	vec_add(in[10], in[10], in[11]);
	vec_add(pre[2], pre[2], in[10]);
	vec_add(in[14], in[14], in[10]);
	vec_add(pre[0], pre[0], in[14]);
	vec_add(in[15], in[15], in[14]);
	vec_add(pre[1], pre[1], in[15]);
	vec_add(in[13], in[13], in[15]);
	vec_add(pre[0], pre[0], in[13]);
	vec_add(in[12], in[12], in[13]);
	vec_add(pre[3], pre[3], in[12]);
	vec_add(in[4], in[4], in[12]);
	vec_add(pre[0], pre[0], in[4]);
	vec_add(in[5], in[5], in[4]);
	vec_add(pre[1], pre[1], in[5]);
	vec_add(in[7], in[7], in[5]);
	vec_add(pre[0], pre[0], in[7]);
	vec_add(in[6], in[6], in[7]);
	vec_add(pre[2], pre[2], in[6]);
	vec_add(in[2], in[2], in[6]);
	vec_add(pre[0], pre[0], in[2]);
	vec_add(in[3], in[3], in[2]);
	vec_add(pre[1], pre[1], in[3]);
	vec_add(in[1], in[1], in[3]);
	vec_add(pre[0], pre[0], in[1]);
	vec_add(out[0], in[0], in[1]);

	for (j = 0; j < MCELIECE_GFBITS; j++) 
	{
		tmp[j] = (beta[0] >> j) & 1;
		tmp[j] = ~tmp[j] + 1;
	}

	vec_mul(out[1], pre[0], tmp);

	for (i = 1; i < 6; i++) 
	{
		for (j = 0; j < MCELIECE_GFBITS; j++) 
		{
			tmp[j] = (beta[i] >> j) & 1;
			tmp[j] = ~tmp[j] + 1;
		}

		vec_mul(tmp, pre[i], tmp);
		vec_add(out[1], out[1], tmp);
	}
}

void fft_tr(uint64_t out[][MCELIECE_GFBITS], uint64_t in[][MCELIECE_GFBITS])
{
	butterflies_tr(out, in);
	radix_conversions_tr(out);
}
